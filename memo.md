│ │ DDDの観点からの分析と改善案                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                              │ │
│ │ 現在の構造の問題点                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                              │ │
│ │ 1. 責務の分散: バリデーションロジックが schemas/ と utils/validate* に分かれている                                                                                                                                           │ │
│ │ 2. ドメインモデルの不在: エンティティやバリュオブジェクトが明確に定義されていない                                                                                                                                            │ │
│ │ 3. ドメインロジックの散在: ビジネスルールが複数の層に散在している                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                              │ │
│ │ 改善案：より DDD に忠実な構造                                                                                                                                                                                                │ │
│ │                                                                                                                                                                                                                              │ │
│ │ src/features/{domain}/                                                                                                                                                                                                       │ │
│ │ ├── domain/                    # ドメイン層                                                                                                                                                                                  │ │
│ │ │   ├── models/                # ドメインモデル                                                                                                                                                                              │ │
│ │ │   │   ├── news.ts           # エンティティ                                                                                                                                                                                 │ │
│ │ │   │   └── category.ts       # エンティティ                                                                                                                                                                                 │ │
│ │ │   ├── value-objects/         # 値オブジェクト                                                                                                                                                                              │ │
│ │ │   │   ├── news-title.ts     # タイトル値オブジェクト                                                                                                                                                                       │ │
│ │ │   │   ├── news-url.ts       # URL値オブジェクト                                                                                                                                                                            │ │
│ │ │   │   └── news-quote.ts     # 引用値オブジェクト                                                                                                                                                                           │ │
│ │ │   ├── schemas/               # ドメイン検証スキーマ                                                                                                                                                                        │ │
│ │ │   │   └── news-schema.ts    # Zodスキーマ                                                                                                                                                                                  │ │
│ │ │   └── services/              # ドメインサービス                                                                                                                                                                            │ │
│ │ │       └── news-validator.ts # バリデーションロジック                                                                                                                                                                       │ │
│ │ ├── application/               # アプリケーション層                                                                                                                                                                          │ │
│ │ │   ├── use-cases/            # ユースケース                                                                                                                                                                                 │ │
│ │ │   │   ├── add-news.ts      # ニュース追加                                                                                                                                                                                  │ │
│ │ │   │   └── get-news.ts      # ニュース取得                                                                                                                                                                                  │ │
│ │ │   └── dto/                  # データ転送オブジェクト                                                                                                                                                                       │ │
│ │ │       └── news-dto.ts                                                                                                                                                                                                      │ │
│ │ ├── infrastructure/            # インフラストラクチャ層                                                                                                                                                                      │ │
│ │ │   └── repositories/         # リポジトリ実装                                                                                                                                                                               │ │
│ │ │       ├── news-command-repository.ts                                                                                                                                                                                       │ │
│ │ │       └── news-query-repository.ts                                                                                                                                                                                         │ │
│ │ └── presentation/             # プレゼンテーション層                                                                                                                                                                         │ │
│ │     └── components/                                                                                                                                                                                                          │ │
│ │         ├── client/                                                                                                                                                                                                          │ │
│ │         └── server/                                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                              │ │
│ │ 具体的な変更内容                                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                              │ │
│ │ 1. schemas と validate を統合:                                                                                                                                                                                               │ │
│ │   - domain/schemas/ に Zod スキーマを配置                                                                                                                                                                                    │ │
│ │   - domain/services/ にバリデーションサービスを配置                                                                                                                                                                          │ │
│ │   - これらを組み合わせて使用                                                                                                                                                                                                 │ │
│ │ 2. 値オブジェクトの導入:                                                                                                                                                                                                     │ │
│ │   - NewsTitle, NewsUrl などの値オブジェクトを作成                                                                                                                                                                            │ │
│ │   - 各値オブジェクトが自身のバリデーションロジックを持つ                                                                                                                                                                     │ │
│ │ 3. 層の責務を明確化:                                                                                                                                                                                                         │ │
│ │   - domain/: ビジネスロジックとルール                                                                                                                                                                                        │ │
│ │   - application/: ユースケースの調整                                                                                                                                                                                         │ │
│ │   - infrastructure/: 外部システムとの連携                                                                                                                                                                                    │ │
│ │   - presentation/: UI関連                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                              │ │
│ │ 移行例                                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                              │ │
│ │ Before: 分散したバリデーション                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                              │ │
│ │ // schemas/news-schema.ts                                                                                                                                                                                                    │ │
│ │ export const newsSchema = z.object({...})                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                              │ │
│ │ // utils/validate-news.ts                                                                                                                                                                                                    │ │
│ │ export function validateNews(formData: FormData) {...}                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                              │ │
│ │ After: 統合されたドメインサービス                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                              │ │
│ │ // domain/services/news-validator.ts                                                                                                                                                                                         │ │
│ │ import { newsSchema } from '../schemas/news-schema';                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                              │ │
│ │ export class NewsValidator {                                                                                                                                                                                                 │ │
│ │   static validate(formData: FormData) {                                                                                                                                                                                      │ │
│ │     // スキーマとバリデーションロジックを統合                                                                                                                                                                                │ │
│ │     return newsSchema.safeParse(this.extractData(formData));                                                                                                                                                                 │ │
│ │   }                                                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                              │ │
│ │   private static extractData(formData: FormData) {                                                                                                                                                                           │ │
│ │     // FormDataからのデータ抽出ロジック                                                                                                                                                                                      │ │
│ │   }                                                                                                                                                                                                                          │ │
│ │ }                                                                                                                                                                                                                            │ │
│ │                                                                                                                                                                                                                              │ │
│ │ この構造により、ドメインロジックが明確になり、保守性と拡張性が向上します。