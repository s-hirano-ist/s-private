# TODO リスト

## フッターナビゲーション パフォーマンス最適化の今後の改善計画

### フェーズ2: データ取得の最適化

#### 1. ルートレベルキャッシング
- **目的**: layout別のデータを効率的にキャッシュし、不要な再フェッチを防ぐ
- **実装方法**:
  - `revalidatePath`を使用したlayout固有のキャッシュ戦略
  - データ変更時の選択的キャッシュ無効化
  - layout切り替え時の既存データ再利用
- **対象ファイル**:
  - `src/application-services/*/get-*.ts` - データフェッチ関数
  - 各並列ルートのpage.tsx

#### 2. 非アクティブタブの遅延読み込み
- **目的**: 表示されていないタブのデータ取得を遅延し、初期レンダリングを高速化
- **実装方法**:
  - タブが最初に表示される際にのみデータフェッチを実行
  - `Suspense`境界を活用した段階的データローディング
  - ViewportAPIを使用したタブの可視性検出
- **対象ファイル**:
  - `src/components/common/layouts/nav/root-tab.tsx`
  - 各並列ルートのpage.tsx

#### 3. Suspense境界の改善
- **目的**: より細かい粒度でのローディング制御を実現
- **実装方法**:
  - Counter、Form、Stackコンポーネントそれぞれに独立したSuspense境界
  - コンポーネントレベルでのエラーバウンダリ改善
  - ストリーミングレンダリングの活用
- **対象ファイル**:
  - 各Feature内のserverコンポーネント
  - `src/components/common/layouts/error-permission-boundary.tsx`

### フェーズ3: 代替ナビゲーション パターン

#### 1. ルートグループの検討
- **目的**: searchParamsではなく物理的なルート分離によるパフォーマンス向上
- **実装方法**:
  - `src/app/[locale]/(dumper)/` と `src/app/[locale]/(viewer)/` の分離
  - 共通コンポーネントの抽象化
  - ルート間遷移時のプリフェッチ戦略
- **メリット**:
  - URL変更によるページ再評価の軽減
  - より明確なルート構造
  - Next.js最適化の恩恵を最大限活用
- **課題**:
  - コードの重複可能性
  - 現在のタブ状態管理との互換性

#### 2. クライアント側状態管理
- **目的**: URL操作を最小限に抑えたlayout管理
- **実装方法**:
  - React Context + useReducerによるlayout状態管理
  - localStorage/sessionStorageでの状態永続化
  - 初期ロード時のみURL参照
- **メリット**:
  - router.replace()呼び出しの削減
  - より高速なレスポンス
  - 複雑なUI状態管理に対応
- **課題**:
  - ブックマーク・共有時のURL一致性
  - SEO影響の検討

#### 3. プリロード戦略
- **目的**: バックグラウンドでの先行データ取得により体感速度向上
- **実装方法**:
  - Intersection Observer APIによる事前データフェッチ
  - Service Workerを活用したバックグラウンド処理
  - React 18の並行機能（Concurrent Features）の活用
- **対象**:
  - 非アクティブlayoutのデータ
  - 次にアクセス確率の高いタブのデータ
  - 画像・メディアファイルの先行読み込み

### 実装優先度

1. **高**: フェーズ2-2（非アクティブタブの遅延読み込み）
2. **中**: フェーズ2-1（ルートレベルキャッシング）
3. **中**: フェーズ2-3（Suspense境界の改善）
4. **低**: フェーズ3-3（プリロード戦略）
5. **検討**: フェーズ3-1（ルートグループ）、フェーズ3-2（クライアント側状態管理）

### パフォーマンス測定指標

- **Largest Contentful Paint (LCP)**: 主要コンテンツの表示時間
- **First Input Delay (FID)**: ユーザーインタラクションの応答時間
- **Cumulative Layout Shift (CLS)**: レイアウト変更の安定性
- **Time to Interactive (TTI)**: インタラクション可能になるまでの時間

各フェーズ実装後は上記指標の測定と改善効果の検証を実施する。